<p>The <em class='rn_Highlight'>Credit</em> <em class='rn_Highlight'>Calculator</em> helps you quickly <em class='rn_Highlight'>calculate</em> the <em class='rn_Highlight'>credit</em> owed to a customer for completed orders that can't be amended. It ensures accurate adjustments for percentage, fixed price, or money off discounts.</p>

<div class="calculator-container">
<h2><em class='rn_Highlight'>Credit</em> <em class='rn_Highlight'>Calculator</em></h2>
<br />
<!-- Tabs -->
<div class="tabs">
<div class="tab active" onclick="switchTab('percentage')">Percentage Off</div>

<div class="tab" onclick="switchTab('money')">Money Off</div>

<div class="tab" onclick="switchTab('fixed')">Fixed Price</div>
</div>
<!-- Percentage Off Tab -->

<div class="tab-content active" id="percentage">
<h3>Percentage Off</h3>

<table>
	<thead>
		<tr>
			<th>Product Code</th>
			<th>Value Paid</th>
			<th>Discount (%)</th>
			<th>&nbsp;</th>
		</tr>
	</thead>
	<tbody id="percentageBody"><!-- Rows will be added dynamically -->
	</tbody>
</table>
</div>
<!-- Money Off Tab -->

<div class="tab-content" id="money">
<h3>Money Off</h3>

<table>
	<thead>
		<tr>
			<th>Product Code</th>
			<th>Value Paid</th>
			<th>Discount Amount</th>
			<th>&nbsp;</th>
		</tr>
	</thead>
	<tbody id="moneyBody"><!-- Rows will be added dynamically -->
	</tbody>
</table>
</div>
<!-- Fixed Price Tab -->

<div class="tab-content" id="fixed">
<h3>Fixed Price</h3>

<div class="tax-toggle"><button class="active" id="taxButton" onclick="toggleTax(true)">Tax</button><button id="noTaxButton" onclick="toggleTax(false)">No Tax</button></div>

<table>
	<thead>
		<tr>
			<th>Product Code</th>
			<th id="basePriceHeader">Default Price</th>
			<th>Value Paid</th>
			<th>New Price</th>
			<th>&nbsp;</th>
		</tr>
	</thead>
	<tbody id="fixedBody"><!-- Rows will be added dynamically -->
	</tbody>
</table>
</div>
<!-- Offer Code and Shipping Fee Grouped -->

<div class="offer-shipping-group">
<div class="field-group"><label>Offer Code:</label> <input id="offerCode" placeholder="Enter Offer Code" type="text" /></div>

<div class="field-group"><label>Shipping Fee:</label> <input id="shippingFee" placeholder="0.00" step="0.01" type="number" />
<div class="shipping-toggle"><button id="addShippingButton" onclick="adjustShipping('add')">Add</button><button id="removeShippingButton" onclick="adjustShipping('remove')">Remove</button></div>
</div>
</div>
<!-- Control Buttons -->

<div class="control-buttons"><button id="addLineButton" onclick="addRow(currentTab)">Add New Line</button><button id="calculateCreditButton" onclick="calculateCredit()"><em class='rn_Highlight'>Calculate</em> <em class='rn_Highlight'>Credit</em></button><button id="resetButton" onclick="resetCalculator()">Reset</button><button id="copyButton" onclick="copyResults()">Copy</button></div>
<!-- Results -->

<div id="result">Results will appear here.</div>
</div>

<div class="user-guide-container">
<h3>How to Use the <em class='rn_Highlight'>Credit</em> <em class='rn_Highlight'>Calculator</em></h3>

<p>Welcome to the <em class='rn_Highlight'>Credit</em> <em class='rn_Highlight'>Calculator</em>! This tool will help you <em class='rn_Highlight'>calculate</em> the total <em class='rn_Highlight'>credit</em> owed to a customer when honouring a discount after an order has been placed. Follow the steps below to get started:</p>

<h4><strong>1. Choose a Discount Type</strong></h4>

<p>There are three types of discounts available. Select the appropriate tab based on the type of discount you're applying:</p>

<ul>
	<li><strong>Percentage Off</strong> - Use this when applying a percentage discount (e.g., 10% off).</li>
	<li><strong>Money Off</strong> - Use this for a fixed amount off the total (e.g., $30 off). The discount will be divided equally if there are multiple items.</li>
	<li><strong>Fixed Price</strong> - Use this to set a new price for the item(s). Toggle between "Tax" and "No Tax" to include or exclude tax in the <em class='rn_Highlight'>calculation</em>.</li>
</ul>
&nbsp;

<p>⚠️ If your customer <strong>already has a discount</strong> on their order, please continue with the <em class='rn_Highlight'>calculation</em> by entering the value of each item. Once you have a final voucher total, deduct the discount given from the amount <em class='rn_Highlight'>calculated</em>. (You can find the original discount total in OPTIONS)⚠️</p>

<h4><strong>2. Add Item Details</strong></h4>

<p>For each item, click the <strong>Add New Line</strong> button to add a row in the <em class='rn_Highlight'>calculator</em>. Enter the details for each item as follows:</p>

<ul>
	<li><strong>Product Code</strong> - Enter the product code.</li>
	<li><strong>Value Paid</strong> - Enter the original price the customer paid for the item.</li>
	<li><strong>Discount/Price</strong> - Enter the discount percentage, amount, or new price based on the selected discount type.</li>
</ul>
&nbsp;

<h4><strong>3. Adjust Tax (Fixed Price Only)</strong></h4>

<p>If using the <strong>Fixed Price</strong> tab, you can toggle between <strong>Tax</strong> and <strong>No Tax</strong> to <em class='rn_Highlight'>calculate</em> based on whether tax was applied to the item.</p>

<h4><strong>4. Add Shipping Fees</strong></h4>

<p>If the order includes shipping adjustments, enter the amount in the <strong>Shipping Fee</strong> field and specify if it should be <strong>Added</strong> or <strong>Removed</strong> from the total. For example:</p>

<ul>
	<li><strong>Add</strong> - Customer previously paid for shipping, but now gets it free.</li>
	<li><strong>Remove</strong> - Customer initially received free shipping, but now pays for it.</li>
</ul>
&nbsp;

<h4><strong>5. Enter Offer Code</strong></h4>

<p>Always ask the customer for the offer code received or locate the matching code from our CSR Brief. Enter the code in the <strong>Offer Code</strong> field. This will be included in the final results for clarity.</p>

<h4><strong>6. <em class='rn_Highlight'>Calculate</em> <em class='rn_Highlight'>Credit</em></strong></h4>

<p>Click the <strong><em class='rn_Highlight'>Calculate</em> <em class='rn_Highlight'>Credit</em></strong> button to display the final <em class='rn_Highlight'>calculation</em> in the results box below. The results will show the original price, discount for each item, the new lower price and the total <em class='rn_Highlight'>credit</em> owed to the customer.</p>

<h4><strong>7. Reset <em class='rn_Highlight'>Calculator</em></strong></h4>

<p>To clear all entries and start over, click the <strong>Reset</strong> button. This will reset the form for a new <em class='rn_Highlight'>calculation</em>.</p>

<h4><strong>8. Copy Results</strong></h4>

<p>To copy the results to your clipboard, click the <strong>Copy</strong> button. You can then paste the results directly into OPTIONS and send this over to Systems Tray to process your customer's e-voucher.</p>

<h4><strong>9. Delete Row</strong></h4>

<p>If you need to remove a row from your <em class='rn_Highlight'>calculation</em>, select the bin icon ?️ which is the 'delete' button.&nbsp;</p>
  </div>
<style type="text/css">.user-guide-container {
            background-color: #f4f8fb;
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            font-family: Arial, sans-serif;
            color: #333;
        }

        .user-guide-container h3 {
            font-size: 1.5em;
            color: #007BFF;
        }

        .user-guide-container h4 {
            margin-top: 15px;
            font-size: 1.2em;
            color: #333;
        }

        .user-guide-container p {
            font-size: 1em;
            line-height: 1.5;
            color: #555;
        }

        .user-guide-container ul {
            list-style-type: disc;
            margin: 10px 20px;
        }

        .user-guide-container ul li {
            margin-bottom: 8px;
            color: #555;
        }

        .user-guide-container strong {
            color: #333;
        }
  			body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
        .calculator-container {
            background-color: #fff;
            max-width: 900px;
            margin: auto;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        .calculator-container h2 {
            text-align: center;
        }
        .tabs, .control-buttons {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
        }
        .tab, .control-buttons button {
            padding: 10px;
            cursor: pointer;
            background-color: #eee;
            border-radius: 5px;
            text-align: center;
            border: none;
            transition: background-color 0.2s ease;
        }
        .tab.active {
            background-color: #007BFF;
            color: #fff;
        }
        .control-buttons button.active-blue {
            background-color: #007BFF;
            color: #fff;
        }
        .control-buttons button.calculate-active {
            background-color: #28a745;
            color: #fff;
        }
        .control-buttons button.reset-active {
            background-color: #dc3545;
            color: #fff;
        }
        .control-buttons button.copy-active {
            background-color: #fd7e14;
            color: #fff;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .tax-toggle, .shipping-toggle {
            display: flex;
            justify-content: center;
            margin-bottom: 10px;
        }
        .tax-toggle button, .shipping-toggle button {
            padding: 10px;
            margin: 0 5px;
            flex: 1;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            background-color: #eee;
            color: #000;
            transition: background-color 0.2s ease;
        }
        .tax-toggle button.active, .shipping-toggle button.active {
            background-color: #007BFF;
            color: #fff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ccc;
        }
        .actions button {
            padding: 5px 10px;
            cursor: pointer;
        }
        .delete-icon {
            width: 22px;
            height: 22px;
            display: block;
            margin: auto;
        }
        #result {
            background-color: #f9f9f9;
            padding: 10px;
            min-height: 100px;
            white-space: pre-wrap;
            border: 1px solid #ccc;
            border-radius: 5px;
            margin-top: 20px;
        }
        .offer-shipping-group {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .offer-shipping-group .field-group {
            flex: 1;
            margin: 0 5px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        .offer-shipping-group label, .offer-shipping-group input {
            display: block;
            width: 100%;
            box-sizing: border-box;
            margin: 5px 0;
        }
</style>
<script>
    let currentTab = 'percentage';

    function switchTab(tabId) {
        currentTab = tabId;
        document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
        document.getElementById(tabId).classList.add('active');

        // Clear the calculator's results when switching tabs
        document.getElementById('result').textContent = 'Results will appear here.';
        
        if (tabId === 'fixed') {
            document.getElementById('fixedBody').innerHTML = ''; // Clear existing rows
            addRow(tabId); // Add default row for fixed price
        }
    }

    function addRow(tabId) {
        const tbody = document.getElementById(`${tabId}Body`);
        const row = document.createElement('tr');
        const isTaxEnabled = document.getElementById('taxButton').classList.contains('active');

        if (tabId === 'percentage' || tabId === 'money') {
            row.innerHTML = `
                <td><input type="text" placeholder="Product Code"></td>
                <td><input type="number" placeholder="Value Paid" step="0.01"></td>
                <td><input type="number" placeholder="${tabId === 'percentage' ? 'Discount (%)' : 'Discount Amount'}" step="0.01"></td>
                <td class="actions"><img src="https://cdn-icons-png.flaticon.com/128/18221/18221931.png" alt="Delete" class="delete-icon" onclick="removeRow
                (this)"></td>
            `;
        } else if (tabId === 'fixed') {
            row.innerHTML = `
                <td><input type="text" placeholder="Product Code"></td>
                ${isTaxEnabled ? '<td><input type="number" placeholder="Default Price" step="0.01"></td>' : ''}
                <td><input type="number" placeholder="Value Paid" step="0.01"></td>
                <td><input type="number" placeholder="New Price" step="0.01"></td>
                <td class="actions"><img src="https://cdn-icons-png.flaticon.com/128/18221/18221931.png" alt="Delete" class="delete-icon" onclick="removeRow(this)"></td>
            `;
        }

        // Append the row to the table body
        tbody.appendChild(row);
    }

    function removeRow(button) {
        let row = button.parentElement.parentElement;
        row.parentElement.removeChild(row);
    }

    function toggleTax(hasTax) {
        let taxButton = document.getElementById('taxButton');
        let noTaxButton = document.getElementById('noTaxButton');
        let basePriceHeader = document.getElementById('basePriceHeader');

        if (hasTax) {
            taxButton.classList.add('active');
            noTaxButton.classList.remove('active');
            basePriceHeader.style.display = ''; // Show Default Price field in the header
        } else {
            taxButton.classList.remove('active');
            noTaxButton.classList.add('active');
            basePriceHeader.style.display = 'none'; // Hide Default Price field in the header
        }

        // Clear rows and reset the table structure based on tax selection
        document.getElementById('fixedBody').innerHTML = '';
        addRow('fixed'); // Add a default row based on the current tax/no-tax setting
    }

    function adjustShipping(action) {
        const addShippingButton = document.getElementById('addShippingButton');
        const removeShippingButton = document.getElementById('removeShippingButton');
        const shippingFee = parseFloat(document.getElementById('shippingFee').value) || 0;

        if (action === 'add') {
            addShippingButton.classList.add('active');
            removeShippingButton.classList.remove('active');
            document.getElementById('result').dataset.shippingAdjustment = shippingFee;
            document.getElementById('result').dataset.shippingAction = 'add';
        } else {
            addShippingButton.classList.remove('active');
            removeShippingButton.classList.add('active');
            document.getElementById('result').dataset.shippingAdjustment = -shippingFee;
            document.getElementById('result').dataset.shippingAction = 'remove';
        }
    }

    function calculateCredit() {
        let resultText = '';
        let totalCredit = 0;

        function processRows(tabId, discountType) {
            const rows = document.querySelectorAll(`#${tabId}Body tr`);
            let totalDiscountAmount = 0;
            let rowCount = rows.length;

            if (discountType === 'money' && rowCount > 0) {
                const discountInput = parseFloat(rows[0].querySelector('td:nth-child(3) input').value) || 0;
                totalDiscountAmount = discountInput / rowCount; // Divide discount amount equally across rows
            }

            rows.forEach(row => {
                const cells = row.querySelectorAll('td');
                const productCode = cells[0].querySelector('input').value || 'N/A';
                const valuePaidIndex = tabId === 'fixed' && document.getElementById('taxButton').classList.contains('active') ? 2 : 1;
                const newValueIndex = discountType === 'money' ? 2 : valuePaidIndex + 1;
                const valuePaid = parseFloat(cells[valuePaidIndex].querySelector('input').value) || 0;
                const newValue = discountType === 'money' ? totalDiscountAmount : parseFloat(cells[newValueIndex].querySelector('input').value) || 0;
                let discountAmount = 0;
                let finalPrice = 0;

                if (!valuePaid || !newValue) return;

                if (discountType === 'percentage') {
                    discountAmount = (valuePaid * newValue) / 100;
                    finalPrice = valuePaid - discountAmount;
                } else if (discountType === 'money') {
                    discountAmount = newValue;
                    finalPrice = valuePaid - discountAmount;
                } else if (discountType === 'fixed') {
                    if (document.getElementById('taxButton').classList.contains('active')) {
                        const basePrice = parseFloat(cells[1].querySelector('input').value) || 0;
                        const taxRate = (valuePaid - basePrice) / basePrice;
                        finalPrice = newValue + (newValue * taxRate);
                    } else {
                        finalPrice = newValue;
                    }
                    discountAmount = valuePaid - finalPrice;
                }

                totalCredit += discountAmount;
                resultText += `${productCode} was: ${valuePaid.toFixed(2)}, discount: ${discountAmount.toFixed(2)}, now: ${finalPrice.toFixed(2)}\n`;
            });
        }

        // Process each tab
        processRows('percentage', 'percentage');
        processRows('money', 'money');
        processRows('fixed', 'fixed');

        // Handle shipping
        const shippingFee = parseFloat(document.getElementById('shippingFee').value) || 0;
        const shippingAction = document.getElementById('result').dataset.shippingAction;
        if (shippingAction) {
            totalCredit += shippingAction === 'add' ? shippingFee : -shippingFee;
            resultText += `Shipping ${shippingAction === 'add' ? 'added' : 'removed'}: ${shippingFee.toFixed(2)}\n`;
        }

        // Offer code
        const offerCode = document.getElementById('offerCode').value;
        if (offerCode) {
            resultText += `\nOffer Code: ${offerCode}\n`;
        }

        resultText += `\nTotal Credit Owed: ${totalCredit.toFixed(2)}\nSent to ST.`;
        document.getElementById('result').textContent = resultText;
    }

    function resetCalculator() {
        document.querySelectorAll('.tab-content tbody').forEach(tbody => tbody.innerHTML = '');
        document.getElementById('result').textContent = 'Results will appear here.';
        document.getElementById('offerCode').value = '';
        document.getElementById('shippingFee').value = '';
        document.getElementById('result').dataset.shippingAction = '';
        document.getElementById('addShippingButton').classList.remove('active');
        document.getElementById('removeShippingButton').classList.remove('active');
        
        document.getElementById('taxButton').classList.add('active');
        document.getElementById('noTaxButton').classList.remove('active');
        document.getElementById('basePriceHeader').style.display = '';
        
        addRow('percentage');
        addRow('money');
        addRow('fixed');
    }

    function copyResults() {
        const resultText = document.getElementById('result').textContent;
        navigator.clipboard.writeText(resultText).then(() => {
            const copyButton = document.getElementById('copyButton');
            copyButton.classList.add('copy-active');
            alert('Results copied to clipboard!');
            setTimeout(() => {
                copyButton.classList.remove('copy-active');
            }, 1000);
        }).catch(err => {
            alert('Failed to copy results: ' + err);
        });
    }

    document.getElementById('addLineButton').addEventListener('mousedown', function() {
        this.classList.add('active-blue');
    });
    document.getElementById('addLineButton').addEventListener('mouseup', function() {
        this.classList.remove('active-blue');
    });
    document.getElementById('calculateCreditButton').addEventListener('mousedown', function() {
        this.classList.add('calculate-active');
    });
    document.getElementById('calculateCreditButton').addEventListener('mouseup', function() {
        this.classList.remove('calculate-active');
    });
    document.getElementById('resetButton').addEventListener('mousedown', function() {
        this.classList.add('reset-active');
    });
    document.getElementById('resetButton').addEventListener('mouseup', function() {
        this.classList.remove('reset-active');
    });
    document.getElementById('copyButton').addEventListener('mousedown', function() {
        this.classList.add('copy-active');
    });
    document.getElementById('copyButton').addEventListener('mouseup', function() {
        this.classList.remove('copy-active');
    });

    window.onload = function() {
        resetCalculator();
    };
</script></div></div>
